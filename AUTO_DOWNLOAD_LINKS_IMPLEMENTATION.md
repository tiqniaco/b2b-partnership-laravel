# โ ุชู ุชูููุฐ ูุธุงู ุฅูุดุงุก ุฑูุงุจุท ุงูุชุญููู ุงูุชููุงุฆูุฉ

## ๐ ููุฎุต ุงูุชุญุฏูุซุงุช

ุชู ุฅุถุงูุฉ ูุธุงู ุชููุงุฆู ูุฅูุดุงุก ุฑูุงุจุท ุงูุชุญููู ูุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ุนูุฏ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ ุฅูู `approved` ุฃู `completed`.

## ๐ง ุงููููุงุช ุงููุญุฏุซุฉ:

### 1. StoreOrderController.php
**ุงููุณุงุฑ:** `app/Http/Controllers/Store/StoreOrderController.php`

**ุงูุชุญุฏูุซ:** ุชู ุฅุถุงูุฉ ููุทู ุฅูุดุงุก ุฑูุงุจุท ุงูุชุญููู ูู ุฏุงูุฉ `update()`:

```php
// ุฅูุดุงุก ุฑูุงุจุท ุงูุชุญููู ุนูุฏ ุงูููุงููุฉ ุนูู ุงูุทูุจ ุฃู ุงูุชูุงูู
if (in_array($order->status, ['approved', 'completed']) && $oldStatus !== $order->status) {
    $user = $order->user;
    $products = $order->products; // ุฌูุจ ุฌููุน ุงูููุชุฌุงุช ูู ุงูุทูุจ
    $downloadTokens = [];

    foreach ($products as $product) {
        // ุฅูุดุงุก ุฑุงุจุท ุชุญููู ููู ููุชุฌ
        $token = app(\App\Services\DownloadService::class)
            ->createDownloadToken($user, $product, 3, 1, $order->id);
        
        $downloadTokens[] = $token;
    }

    if (!empty($downloadTokens)) {
        // ุฅุฑุณุงู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูุน ุฑูุงุจุท ุงูุชุญููู
        app(\App\Services\EmailService::class)
            ->sendDownloadLinksEmail($user, $order, $downloadTokens);

        // ุฅุฑุณุงู ุฅุดุนุงุฑ FCM (ุงุฎุชูุงุฑู)
        app(\App\Services\FCMService::class)
            ->sendToUser($user, 'โ ุทูุจู ุฌุงูุฒ ููุชุญููู', 'ุงุถุบุท ูุชุญููู ุงูุญููุจุฉ ุงูุชุฏุฑูุจูุฉ.');
    }
}
```

### 2. StoreOrder.php Model
**ุงููุณุงุฑ:** `app/Models/StoreOrder.php`

**ุงูุชุญุฏูุซ:** ุชู ุฅุถุงูุฉ ุนูุงูุฉ `products()` ูููุตูู ููููุชุฌุงุช:

```php
public function products()
{
    return $this->belongsToMany(StoreProduct::class, 'store_carts', 'order_id', 'product_id');
}
```

## ๐ฏ ููู ูุนูู ุงููุธุงู:

### 1. ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
```http
PUT /api/store/orders/{order_id}
Content-Type: application/json
Authorization: Bearer {token}

{
    "status": "approved"
}
```

### 2. ุงูุชุณูุณู ุงูุชููุงุฆู:
1. **ุชุญุฏูุซ ุงูุญุงูุฉ** โ ูุชู ุญูุธ ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ
2. **ุฅูุดุงุก Tokens** โ ููู ููุชุฌ ูู ุงูุทูุจ
3. **ุฅุฑุณุงู ุงูุจุฑูุฏ** โ ูุน ุฌููุน ุฑูุงุจุท ุงูุชุญููู  
4. **ุฅุฑุณุงู ุฅุดุนุงุฑ FCM** โ ูููุณุชุฎุฏู

### 3. ุฅุนุฏุงุฏุงุช ุฑูุงุจุท ุงูุชุญููู:
- **max_downloads**: 3 ูุฑุงุช ุชุญููู
- **expires_days**: 1 ููู (24 ุณุงุนุฉ)
- **ูุฑุชุจุท ุจุงูุทูุจ**: ูุนู (order_id)

## ๐ง ูุญุชูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู:

ูุชู ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู ูุญุชูู ุนูู:
- ูุนูููุงุช ุงูุทูุจ
- ุฑูุงุจุท ุชุญููู ุขููุฉ ููู ููุชุฌ
- ุชุนูููุงุช ุงูุงุณุชุฎุฏุงู
- ูุฏุฉ ุงูุตูุงุญูุฉ ูุนุฏุฏ ูุฑุงุช ุงูุชุญููู

## ๐ฑ ุงูุฅุดุนุงุฑ:

ูุชู ุฅุฑุณุงู ุฅุดุนุงุฑ FCM ูุญุชูู ุนูู:
- **ุงูุนููุงู:** "โ ุทูุจู ุฌุงูุฒ ููุชุญููู"
- **ุงููุญุชูู:** "ุงุถุบุท ูุชุญููู ุงูุญููุจุฉ ุงูุชุฏุฑูุจูุฉ."

## ๐ ุงูุชูุงูู ูุน ุงููุธุงู ุงูุญุงูู:

### โ ูุง ูู ูุชุบูุฑ:
- ุฌููุน API responses ุชุจูู ููุง ูู
- ุฃุณูุงุก endpoints ูู ุชุชุบูุฑ
- ุจููุฉ ุงูุงุณุชุฌุงุจุงุช ูุญููุธุฉ
- ุชุทุจูู Flutter ูุนูู ุจุฏูู ุชุนุฏูู

### โ ูุง ุชู ุฅุถุงูุชู:
- ููุทู ุชููุงุฆู ูุนูู ูู ุงูุฎูููุฉ
- ูุง ูุคุซุฑ ุนูู ูุงุฌูุฉ ุงููุณุชุฎุฏู ุงูุญุงููุฉ
- ูููุนู ููุท ุนูุฏ ุชุญุฏูุซ ุงูุญุงูุฉ

## ๐งช ุทุฑููุฉ ุงูุงุฎุชุจุงุฑ:

### 1. ุฅูุดุงุก ุทูุจ ุฌุฏูุฏ:
```bash
# ุฅูุดุงุก ุทูุจ
POST /api/store/orders

# ุชุญุฏูุซ ุงูุญุงูุฉ ุฅูู approved
PUT /api/store/orders/1
{
    "status": "approved"
}
```

### 2. ุงูุชุญูู ูู ุงููุชุงุฆุฌ:
- โ ุชุญูู ูู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุณุชุฎุฏู
- โ ุชุญูู ูู ุฅุดุนุงุฑ FCM
- โ ุชุญูู ูู ุฌุฏูู `download_tokens`

### 3. ุงุฎุชุจุงุฑ ุงูุชุญููู:
```bash
# ุฌูุจ tokens ุงููุณุชุฎุฏู
GET /api/store/my-download-tokens

# ุชุญููู ุจุงุณุชุฎุฏุงู token
GET /download/{token}
```

## ๐ ุงูุญุงูุงุช ุงููุฏุนููุฉ:

| ุงูุญุงูุฉ ุงูุญุงููุฉ | ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ | ุงููุชูุฌุฉ |
|----------------|----------------|----------|
| `pending` | `approved` | โ ุฅูุดุงุก tokens + ุฅุฑุณุงู ุจุฑูุฏ |
| `pending` | `completed` | โ ุฅูุดุงุก tokens + ุฅุฑุณุงู ุจุฑูุฏ |
| `approved` | `completed` | โ ุฅูุดุงุก tokens + ุฅุฑุณุงู ุจุฑูุฏ |
| `approved` | `approved` | โ ูุง ุดูุก (ููุณ ุงูุญุงูุฉ) |
| `completed` | `canceled` | โ ูุง ุดูุก (ููุณุช ุญุงูุฉ ููุนูุฉ) |

## ๐ก๏ธ ุงูุฃูุงู:

### โ ููุฒุงุช ุงูุฃูุงู:
- Tokens ูุฑูุฏุฉ ููุดูุฑุฉ
- ูุฏุฉ ุตูุงุญูุฉ ูุญุฏูุฏุฉ (24 ุณุงุนุฉ)
- ุนุฏุฏ ุชุญูููุงุช ูุญุฏูุฏ (3 ูุฑุงุช)
- ูุฑุชุจุทุฉ ุจุงูุทูุจ ูุงููุณุชุฎุฏู

### โ ุงูุชุญูู ูู ุงูุฃุฎุทุงุก:
- ุงูุชุญูู ูู ูุฌูุฏ ุงูููุชุฌุงุช
- ุงูุชุญูู ูู ุตุญุฉ ุงูุจูุงูุงุช
- ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฅุฑุณุงู ุงูุจุฑูุฏ
- ูุนุงูุฌุฉ ุฃุฎุทุงุก FCM

## ๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ:

โ **ุชู ุชูููุฐ ุงููุธุงู ุจูุฌุงุญ!**

- ๐ **ูุนูู ุชููุงุฆูุงู** ุนูุฏ ุชุญุฏูุซ ุญุงูุฉ ุงูุทูุจ
- ๐ง **ูุฑุณู ุจุฑูุฏ ุฅููุชุฑููู** ูุน ุฑูุงุจุท ุงูุชุญููู  
- ๐ฑ **ูุฑุณู ุฅุดุนุงุฑ FCM** ูููุณุชุฎุฏู
- ๐ก๏ธ **ุขูู ููุญุฏูุฏ** ุจูุฏุฉ ุตูุงุญูุฉ ูุนุฏุฏ ูุฑุงุช
- ๐ **ูุชูุงูู** ูุน ุงููุธุงู ุงูุญุงูู ุชูุงูุงู

**ุงูุขู ุนูุฏูุง ูุชู ุชุญุฏูุซ ุฃู ุทูุจ ุฅูู `approved` ุฃู `completed`ุ ุณูุญุตู ุงููุณุชุฎุฏู ุชููุงุฆูุงู ุนูู ุจุฑูุฏ ุฅููุชุฑููู ูุฅุดุนุงุฑ ูุน ุฑูุงุจุท ุงูุชุญููู ุงูุขููุฉ! ๐**
